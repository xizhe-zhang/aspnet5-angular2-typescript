@{
    ViewBag.Title = "PhotoGallery";
}

@section styles
{
    <link href="~/lib/css/jquery.fancybox.css" rel="stylesheet" />
    <link href="~/css/site.css" rel="stylesheet" />
    <link href="~/lib/css/alertify.core.css" rel="stylesheet" />
    <link href="~/lib/css/alertify.bootstrap.css" rel="stylesheet" />
    @*<link href="~/lib/css/alertify.default.css" rel="stylesheet" />*@
}

<div id="nav-separator"></div>

<photogallery-app style="display:none">
    <div class="loading">Loading</div>
</photogallery-app>

<div style="display:flex; justify-content: center; flex-direction: column; align-items: center;">
    <div id="qrcode" style="width:200px; height:200px; margin-top:15px;"></div>
    <div id="qrloading" style="margin-top: 30px; font-size: 20px;">
        <span>loading....</span>
    </div>
    <div id="qrword" style="margin-top: 30px; font-size: 20px;display:none">
        <span>Scan qrcode to login in pos</span>
    </div>    
    <div id="wechat" style="display:none;">
        <div>
            <img style="height: 50px;" src="POS.png"></img> Login OK!
        </div>
        <div style="justify-content: center; display: flex;">
            <div id="wechatimageurl"></div>
        </div>
        <br/>
        <div style="justify-content: center; display: flex;">
            <div id="wechatname" style="font-size: 40px; font-weight: bold;"></div>
        </div>
    </div>
<div>

@section scripts
{
    <script src="~/lib/js/jquery.fancybox.pack.js"></script>
    <script src="~/lib/js/alertify.min.js"></script>
    <script src="~/lib/js/qrcode.min.js"></script>
}

@section customScript
{
    System.import('app').catch(console.log.bind(console));
    
    $(document).ready(function() {
        $('.fancybox').fancybox();
    });

    var qrcode = new QRCode(document.getElementById("qrcode"), {
        width : 200,
        height : 200
    });

    function makeCode (qrValue) {		
        if (!qrValue) {
            return;
        }
        qrcode.makeCode(qrValue);
    }

    $.connection.hub.start().done(function (response) {
       $("#qrloading").hide();
       console.log("connection ok:" + response.id);
       $.connection.broadcaster.server.subscribe(1);
       makeCode('{type:pos,id:1}');
       $("#qrword").show();
    });

    $.connection.broadcaster.client.addFeed = function (feed){
        console.log("server call back:" + feed);

        $("#qrcode").hide();
        $("#qrword").hide();
        $("#wechatimageurl").html("<img style='height: 400px;' src='"+ feed.WechatImageUrl +"'></img>");
        $("#wechatname").html("<p>" + feed.WechatName + "</p>");
        $("#wechat").show();
        console.log("login ok!" );

    }

}